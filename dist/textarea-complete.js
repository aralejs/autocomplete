define("arale/autocomplete/1.1.0/autocomplete",["./data-source","./filter","$","arale/overlay/0.9.13/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.0/iframe-shim","arale/widget/1.0.2/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.2/templatable","gallery/handlebars/1.0.0/handlebars"],function(a,b,c){function m(a){return"[object String]"===Object.prototype.toString.call(a)}function n(a,b){if(!a)return b;if(d.isFunction(a))return a.call(this,b);if(m(a)){for(var c=a.split("."),e=b;c.length;){var f=c.shift();if(!e[f])break;e=e[f]}return e}return b}var d=a("$"),e=a("arale/overlay/0.9.13/overlay"),f=a("arale/widget/1.0.2/templatable"),g=a("gallery/handlebars/1.0.0/handlebars"),h=a("./data-source"),i=a("./filter"),j='<div class="{{classPrefix}}">\n<ul class="{{classPrefix}}-ctn" data-role="items">\n{{#each items}}\n<li data-role="item" class="{{../classPrefix}}-item" data-value="{{matchKey}}">{{highlightItem ../classPrefix matchKey}}</li>\n{{/each}}\n</ul>\n</div>',k={UP:38,DOWN:40,LEFT:37,RIGHT:39,ENTER:13,ESC:27,BACKSPACE:8},l=e.extend({Implements:f,attrs:{trigger:{value:null,getter:function(a){return d(a)}},classPrefix:"ui-autocomplete",align:{baseXY:[0,"100%"]},template:j,submitOnEnter:!0,dataSource:[],locator:"data",filter:void 0,inputFilter:function(a){return a},disabled:!1,selectFirst:!1,delay:100,selectedIndex:void 0,inputValue:"",data:[]},events:{"mousedown [data-role=item]":function(){this.selectItem(),this._firstMousedown=!0},mousedown:function(){this._secondMousedown=!0},"mouseenter [data-role=item]":function(a){var b=this.items.index(a.currentTarget);this.set("selectedIndex",b)}},templateHelpers:{highlightItem:function(a,b){var c=this.highlightIndex,e=0,f=b||this.matchKey||"",h="";if(d.isArray(c)){for(var i=0,j=c.length;j>i;i++){var l,m,k=c[i];if(d.isArray(k)?(l=k[0],m=k[1]-k[0]):(l=k,m=1),l>e&&(h+=f.substring(e,l)),f.length>l&&(h+='<span class="'+a+'-item-hl">'+f.substr(l,m)+"</span>"),e=l+m,e>=f.length)break}return f.length>e&&(h+=f.substring(e,f.length)),new g.SafeString(h)}return f}},parseElement:function(){this.model={classPrefix:this.get("classPrefix"),items:[]},l.superclass.parseElement.call(this)},setup:function(){var a=this.get("trigger"),b=this;l.superclass.setup.call(this),this.dataSource=new h({source:this.get("dataSource")}).on("data",this._filterData,this),this._initFilter(),this._blurHide([a]),this._tweakAlignDefaultValue(),a.attr("autocomplete","off").on("blur.autocomplete",d.proxy(this._blurEvent,this)).on("keydown.autocomplete",d.proxy(this._keydownEvent,this)).on("keyup.autocomplete",function(){clearTimeout(b._timeout),b._timeout=setTimeout(function(){b._timeout=null,b._keyupEvent.call(b)},b.get("delay"))})},destroy:function(){this._clear(),this.element.remove(),l.superclass.destroy.call(this)},hide:function(){this._timeout&&clearTimeout(this._timeout),this.dataSource.abort(),l.superclass.hide.call(this)},selectItem:function(){this.hide();var a=this.currentItem,b=this.get("selectedIndex"),c=this.get("data")[b];if(a){var d=a.attr("data-value");this.get("trigger").val(d),this.set("inputValue",d),this.trigger("itemSelect",c),this._clear()}},setInputValue:function(a){if(this.get("inputValue")!==a){this._start=!0,this.set("inputValue",a);var b=this.get("trigger");b.val()!==a&&b.val(a)}},_initFilter:function(){var a=this.get("filter");a=void 0===a?"url"===this.dataSource.get("type")?null:{name:"startsWith",func:i.startsWith,options:{key:"value"}}:d.isPlainObject(a)?i[a.name]?{name:a.name,func:i[a.name],options:a.options}:null:d.isFunction(a)?{func:a}:i[a]?{name:a,func:i[a]}:null,a||(a={name:"default",func:i["default"]}),this.set("filter",a)},_filterData:function(a){var b=this.get("filter"),c=this.get("locator");a=n(c,a),a=b.func.call(this,a,this.queryValue,b.options),this.set("data",a)},_blurEvent:function(){this._secondMousedown?this._firstMousedown&&(this.get("trigger").focus(),this.hide()):this.hide(),delete this._firstMousedown,delete this._secondMousedown},_keyupEvent:function(){if(!this.get("disabled")&&this._keyupStart){delete this._keyupStart;var a=this.get("trigger").val();this.setInputValue(a)}},_keydownEvent:function(a){if(!this.get("disabled"))switch(delete this._keyupStart,a.which){case k.ESC:this.hide();break;case k.UP:this._keyUp(a);break;case k.DOWN:this._keyDown(a);break;case k.LEFT:case k.RIGHT:break;case k.ENTER:this._keyEnter(a);break;default:this._keyupStart=!0}},_keyUp:function(a){if(a.preventDefault(),this.get("data").length){if(!this.get("visible"))return this.show(),void 0;this._step(-1)}},_keyDown:function(a){if(a.preventDefault(),this.get("data").length){if(!this.get("visible"))return this.show(),void 0;this._step(1)}},_keyEnter:function(a){this.get("visible")&&(this.selectItem(),this.get("submitOnEnter")||a.preventDefault())},_step:function(a){var b=this.get("selectedIndex");-1===a?b>0?this.set("selectedIndex",b-1):this.set("selectedIndex",this.items.length-1):1===a&&(this.items.length-1>b?this.set("selectedIndex",b+1):this.set("selectedIndex",0))},_clear:function(){this.$("[data-role=items]").empty(),this.set("selectedIndex",-1),delete this.items,delete this.lastIndex,delete this.currentItem},_tweakAlignDefaultValue:function(){var a=this.get("align");a.baseElement=this.get("trigger"),this.set("align",a)},_onRenderInputValue:function(a){if(this._start&&a){var b=this.queryValue;this.queryValue=this.get("inputFilter").call(this,a),this.queryValue&&this.queryValue!==b&&(this.dataSource.abort(),this.dataSource.getData(this.queryValue))}""!==a&&this.queryValue||(this.set("data",[]),this.hide()),delete this._start},_onRenderData:function(a){this._clear(),this.model.items=a,this.renderPartial("[data-role=items]"),this.items=this.$("[data-role=items]").children(),this.currentItem=null,this.get("selectFirst")&&this.set("selectedIndex",0),d.trim(this.$("[data-role=items]").text())?this.show():this.hide()},_onRenderSelectedIndex:function(a){if(-1!==a){var b=this.get("classPrefix")+"-item-hover";this.currentItem&&this.currentItem.removeClass(b),this.currentItem=this.items.eq(a).addClass(b),this.trigger("indexChange",a,this.lastIndex),this.lastIndex=a}}});c.exports=l}),define("arale/autocomplete/1.1.0/data-source",["arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","$"],function(a,b,c){function g(a){return"[object String]"===Object.prototype.toString.call(a)}function h(a){return a?a.replace(/^([a-z])/,function(a,b){return b.toUpperCase()}):""}var d=a("arale/base/1.0.1/base"),e=a("$"),f=d.extend({attrs:{source:null,type:"array"},initialize:function(a){f.superclass.initialize.call(this,a),this.id=0,this.callbacks=[];var b=this.get("source");if(g(b))this.set("type","url");else if(e.isArray(b))this.set("type","array");else if(e.isPlainObject(b))this.set("type","object");else{if(!e.isFunction(b))throw Error("Source Type Error");this.set("type","function")}},getData:function(a){return this["_get"+h(this.get("type"))+"Data"](a)},abort:function(){this.callbacks=[]},_done:function(a){this.trigger("data",a)},_getUrlData:function(a){var c,b=this,d={query:a?encodeURIComponent(a):"",timestamp:(new Date).getTime()},f=this.get("source").replace(/{{(.*?)}}/g,function(a,b){return d[b]}),g="callback_"+this.id++;this.callbacks.push(g),c=/^(https?:\/\/)/.test(f)?{dataType:"jsonp"}:{dataType:"json"},e.ajax(f,c).success(function(a){e.inArray(g,b.callbacks)>-1&&(delete b.callbacks[g],b._done(a))}).error(function(){e.inArray(g,b.callbacks)>-1&&(delete b.callbacks[g],b._done({}))})},_getArrayData:function(){var a=this.get("source");return this._done(a),a},_getObjectData:function(){var a=this.get("source");return this._done(a),a},_getFunctionData:function(a){function d(a){b._done(a)}var b=this,c=this.get("source"),e=c.call(this,a,d);e&&this._done(e)}});c.exports=f}),define("arale/autocomplete/1.1.0/filter",["$"],function(a,b,c){function f(a,b){if(d.isPlainObject(a)){var c=b&&b.key||"value";return a[c]||""}return a}var d=a("$"),e={"default":function(a,b,c){var e=[];return d.each(a,function(a,b){var g={},h=f(b,c);d.isPlainObject(b)&&(g=d.extend({},b)),g.matchKey=h,e.push(g)}),e},startsWith:function(a,b,c){var e=[],g=b.length,h=RegExp("^"+b);return d.each(a,function(a,b){var i={},j=f(b,c);d.isPlainObject(b)&&(i=d.extend({},b)),h.test(j)&&(i.matchKey=j,g>0&&(i.highlightIndex=[[0,g]]),e.push(i))}),e}};c.exports=e}),define("arale/autocomplete/1.1.0/textarea-complete",["./autocomplete","$","gallery/selection/0.9.0/selection","arale/overlay/0.9.13/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.0/iframe-shim","arale/widget/1.0.2/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.2/templatable","gallery/handlebars/1.0.0/handlebars"],function(a,b,c){var d=a("$"),e=a("gallery/selection/0.9.0/selection"),f=a("./autocomplete"),g=f.extend({attrs:{cursor:!1},setup:function(){g.superclass.setup.call(this),this.sel=e(this.get("trigger"));var a=this.get("inputFilter"),b=this;this.set("inputFilter",function(c){var d=c.substring(0,b.sel.cursor()[1]);return a.call(b,d)}),this.get("cursor")&&(this.mirror=h.init(this.get("trigger")),this.dataSource.before("getData",function(){b.mirror.setContent(b.get("inputValue"),b.queryValue,b.sel.cursor())}))},_keyUp:function(a){this.get("visible")&&(a.preventDefault(),this.get("data").length&&this._step(-1))},_keyDown:function(a){this.get("visible")&&(a.preventDefault(),this.get("data").length&&this._step(1))},_keyEnter:function(a){this.get("visible")&&(this.currentItem?(a.preventDefault(),a.stopImmediatePropagation(),this.selectItem()):this.hide())},show:function(){var a=this.get("cursor");if(a){if(d.isArray(a))var b=a;else var b=[0,0];var c=this.mirror.getFlagRect(),e=this.get("align");e.baseXY=[c.left+b[0],c.bottom+b[1]],e.selfXY=[0,0],this.set("align",e)}g.superclass.show.call(this)},selectItem:function(){this.hide();var a=this.currentItem,b=this.get("selectedIndex"),c=this.get("data")[b];if(a){var d=a.attr("data-value"),e=this.sel.cursor()[1],f=e-this.queryValue.length;this.sel.cursor(f,e).text("").append(d,"right");var g=this.get("trigger").val();this.set("inputValue",g),this.mirror&&this.mirror.setContent(g,"",this.sel.cursor()),this.trigger("itemSelect",c),this._clear()}}}),h={mirror:null,css:["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX"],init:function(a){a=d(a);var b={position:"absolute",left:-9999,top:0,zIndex:-2e4,"white-space":"pre-wrap"};return d.each(this.css,function(c,d){return b[d]=a.css(d)}),this.mirror=d("<div><span></span></div>").css(b).insertAfter(a),this},setContent:function(a,b,c){var d=b?c[1]-b.length:c[1],e=c[1],f=["<span>",a.substring(0,d),"</span>",'<span id="flag">',b||"","</span>","<span>",a.substring(e),"</span>"].join("");return this.mirror.html(f),this},getFlagRect:function(){var a,b,c;return c=this.mirror.find("span#flag"),a=c.position(),b={left:a.left,right:c.width()+a.left,top:a.top,bottom:c.height()+a.top}}};c.exports=g});